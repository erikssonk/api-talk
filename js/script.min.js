function parseCategories(a,b){for(var c=0;c<a.length;c++){var d=a[c],e=b.li.clone(!0);if(e.find("a").html(d.Name).attr("href",d.CategoryUrl).attr("data-id",d.Id),d.HasSubCategories===!0){var f=b.ul.clone();parseCategories(d.SubCategories,{placeHolder:f,ul:b.ul,li:b.li}),e.append(f)}b.placeHolder.append(e)}}var Api={baseUrl:"http://ganillagrace.jetshop.se/Services/rest/v2/json/sv-SE/",fetch:function(a,b,c){if(void 0===c)var c={};return c.url=void 0!==b?this.baseUrl+b+"/"+a:this.baseUrl+a,c.crossDomain=!0,c.dataType="json",jQuery.ajax(c)}},Favorites={favorites:[],add:function(a){var b=this.find(a);b>-1?this.favorites[b]=a:this.favorites.push(a),this.save()},remove:function(a){var b=this.find(a);b>-1&&(this.favorites.splice(b,1),this.save())},isFavorite:function(a){return this.find(a)>-1},find:function(a){for(var b=0;b<this.favorites.length;b++)if(this.favorites[b].Id===a.Id)return b;return-1},save:function(){localStorage.setItem("jetshop.favs",JSON.stringify(this.favorites))},restore:function(){try{this.favorites=JSON.parse(localStorage.getItem("jetshop.favs"))}catch(a){}}},baseUrl=window.location.href;Favorites.restore(),jQuery(document).ready(function(a){var b=a("section.products"),c=b.find("div.tmpl");c.remove().removeClass("tmpl");var d=a("header > ul"),e=d.find("li.tmpl");e.remove().removeClass("tmpl");var f=d.clone(!0);Api.fetch("categories").done(function(a){parseCategories(a,{placeHolder:d,li:e.clone(!0),ul:f.clone(!0)})}),a("header").on("click","a",function(d){return Api.fetch("categories/"+a(this).attr("data-id")+"/products").done(function(a){b.html("");for(var d=0;d<a.ProductItems.length;d++){var e=a.ProductItems[d],f=c.clone(!0);f.find("> h2").html(e.SubName),f.find("> span").html(e.PriceString),f.find("> div > img").attr("src","http://ganillagrace.jetshop.se"+e.Images[0].Url).attr("alt",e.Images[0].AltText),f.attr("data-obj",JSON.stringify(e)),Favorites.isFavorite(e)&&f.find(".fa.fa-heart").toggleClass("active"),b.append(f)}}),!1}),a(document).on("click","a",function(a){return!1}),a(".products").on("click",".fa.fa-heart",function(b){var c=a(this);Product=JSON.parse(c.parents("[data-obj]").attr("data-obj")),c.toggleClass("active"),c.hasClass("active")?Favorites.add(Product):Favorites.remove(Product)})});