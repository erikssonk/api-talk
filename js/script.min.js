function parseCategories(a,b){for(var c=0;c<a.length;c++){var d=a[c],e=b.li.clone(),f=e.find("a");if(""===b.breadcrumb)var g=d.Name;else var g=b.breadcrumb+" &raquo; "+d.Name;if(f.html(d.Name).attr("href",d.CategoryUrl).attr("data-id",d.Id).attr("data-breadcrumb",g),d.HasSubCategories===!0){var h=b.ul.clone();parseCategories(d.SubCategories,{placeHolder:h,ul:b.ul,li:b.li,breadcrumb:g,isChild:!0}),e.append('<i class="fa fa-arrow-down" aria-hidden="true">'),e.append(h)}b.placeHolder.append(e),b.placeHolder.append(" ")}}function parseProducts(a,b){b.placeHolder.html("");for(var c=0;c<a.length;c++){var d=a[c],e=b.div.clone(!0);e.find("> h2").html(d.SubName),e.find("> span").html(d.PriceString),e.find("> div > img").attr("src",b.baseImgUrl+d.Images[0].Url).attr("alt",d.Images[0].AltText),e.attr("data-obj",JSON.stringify(d)),Favorites.isFavorite(d)&&e.find(".fa.fa-heart").toggleClass("active"),b.placeHolder.append(e)}}var Api={baseUrl:"http://ganillagrace.jetshop.se/Services/rest/v2/json/sv-SE/",fetch:function(a,b,c){if(void 0===c)var c={};return c.url=void 0!==b?this.baseUrl+b+"/"+a:this.baseUrl+a,c.crossDomain=!0,c.dataType="json",jQuery.ajax(c)}},Favorites={favorites:[],add:function(a){var b=this.find(a);b>-1?this.favorites[b]=a:this.favorites.push(a),this.save()},remove:function(a){var b=this.find(a);b>-1&&(this.favorites.splice(b,1),this.save())},isFavorite:function(a){return this.find(a)>-1},find:function(a){if(null!==this.favorites)for(var b=0;b<this.favorites.length;b++)if(this.favorites[b].Id===a.Id)return b;return-1},getAll:function(){return this.favorites},save:function(){localStorage.setItem("jetshop.favs",JSON.stringify(this.favorites))},restore:function(){try{this.favorites=JSON.parse(localStorage.getItem("jetshop.favs"))}catch(a){}null===this.favorites&&(this.favorites=[])}},baseUrl=window.location.href;Favorites.restore(),jQuery(document).ready(function(a){var b=a("section.products"),c=b.find("div.tmpl");c.remove().removeAttr("class");var d=a("header > ul"),e=d.find("li.tmpl");e.remove().removeAttr("class");var f=d.clone(!0);Api.fetch("categories").done(function(a){var b=f.clone(!0);b.find("li").remove(),parseCategories(a,{placeHolder:d,li:e.clone(!0),ul:b,breadcrumb:""})}),a("header").on("click","a",function(d){return a(this).hasClass("favorites")?(parseProducts(Favorites.getAll(),{placeHolder:b,div:c,baseImgUrl:"http://ganillagrace.jetshop.se"}),b.addClass("favorites")):Api.fetch("categories/"+a(this).attr("data-id")+"/products").done(function(a){parseProducts(a.ProductItems,{placeHolder:b,div:c,baseImgUrl:"http://ganillagrace.jetshop.se"}),b.removeClass("favorites")}),a(".breadcrumb").html(a(this).attr("data-breadcrumb")),!1}),a(document).on("click","a",function(a){return!1}),a(".products").on("click",".fa.fa-heart",function(c){var d=a(this);Product=JSON.parse(d.parents("[data-obj]").attr("data-obj")),d.toggleClass("active"),d.hasClass("active")?Favorites.add(Product):(Favorites.remove(Product),b.hasClass("favorites")&&d.parents("[data-obj]").fadeOut(300))})});